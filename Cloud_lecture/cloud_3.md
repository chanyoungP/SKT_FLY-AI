# Cloud lecture 3 note 

## 공용 부하분산 장치 

###  클라우드 : 컴퓨팅 네트워킹 스토리지 

> 컴퓨팅에서는 가상머신 개념이 중요 
>
> 스토리지에서는 스토리지 계정 -> 파일 공유 등 
>
> 네트워킹에서는 가상 네트워크, 피어링 개념 

### 공용부하분산장치 로드밸런서 
- 세팅           
> 백엔드풀
    - 실제로 부하 분산시킬 머신 풀 (머신 2개로 분산하겠다 그러면 풀이 2개)
> 상태 프로브
    - 연결된 가상 머신이 살아있는지 등 상태 체크를 정해진 시간마다 체크 패킷을 보내고 응답 받으며 체크한다.
> 부하 분산 규칙
    - 트래픽을 분산시키는 방법을 정의 
> 언바운드 NAT
    - 포트랑 아이피로 실제로 연결 


## Azure Application gate (L7)

### L7은? 
> 클라이언트에서 L7에 요청을 하면 백엔드풀에서 부하분산시켜서 나눠서 처리한다. 근데 URL로도 가능하다. L4는 포트로만 가능 

### L7 구성
- 웹 브라우저 
- 어플리케이션 게이트웨이
- HTTP 리스너 
- 규칙
- 백엔드 풀
큰 회사들은 L7으로 부하분산을 실시한다. 
> - 프론트엔드 : 공용 아이피 개인 아이피 할당
> - HTTP 수신기(리스너) - URL 등 받기 위해서 
> - 라우팅 규칙
> - HTTP 설정
> - 상태 프로브
> - 웹 애플리케이션 방화벽 (WAF) 
>

### 실습
1. 가상 네트워크와 서브넷 만들기
   1. 가상 네트워크 디폴트 제거하고 10.10.0.0 으로 아이피 수정 
   2. 해당 가상 네트워크에 10.10.2.0 서브넷 1 하고 10.10.3.0 서브넷2 만들기 
2. 백엔드풀로 사용할 가상머신 만들기 2대 wuindows VM
   1. 가상 머신 윈도우 서버로 만들기 
   2. 만들어진 가상 네트워크와 프론트 서브넷으로 설정
   3. 공용 아이피는 일단 생성 (나중에 비활성화할 예정)
   4. 인바운드 포트 HTTP HTTPS RDP 세팅
   5. VM삭제시 공용 아이피  NIC 삭제 체크 
   6. 모니터링 부트 진단 사용 안함 체크 (연습이니까 부팅속도 느려져서 )
   7. 똑같이 front 서버에 VM2 를 만든다. 
   8. VM1 접속후 windows powershell ISE 실행 -> Install-WindowsFeature -Name Web-Server -IncludeManagementTools 입력
   9. 윈도우 탐색기 - C - inetpub - wwwroot 에 default.txt 로 파일 만들고 내용 수정한 후에 .htm로 수정   default.htm 파일을 먼저 실행하도록 세팅 돼있음

3. Application gateway를 위한 전용 서브넷 추가
   1. 가상네트워크 서브넷에서 하나를 더 추가 10.10.1.0 으로 추가 
   
4. APplication gateway 만들기
   1. 어플리케이션 게이트웨이 만들기 클릭 
   2. 기본사항 설정
   3. 최소 인스턴스 수 1개 최대 10개 
   4. 프런트엔드 페이지에서 공용 아이피 새로 추가 
   5. 백엔드 클릭 - 백엔드 풀 추가 - 이름설정 - 대상없이 백엔드 풀 추가 아니요 - 대상 : 가상머신 만든거 2개 추가 
   6. 구성 페이지 - 회람규칙추가 - 이름, 우선순위 3 설정 - 수신기 이름 HTTP 설정 -  백엔드대상 백엔드풀 추가 - 백엔드 설정 새로추가 : 이름 설정 나머지는 디폴트 -  만들기 
5. VM들 IP 비활성화 : VM 네트워크 설정 -> 네트워크 인터페이스 -> ip구성 -> 정적으로 바꾸고 공용 IP 비활성화
6. 만들어진 Application gateway 테스팅


### 가상 머신 확장 집합 VMSS

> 로드 밸런스가 관리 -> VM scale set : 부하가 많이 걸리면 가상 머신 수를 정해진 룰에 따라서 증가 시킴. 
>
> 부하가 풀리면 다시 줄임. 
>
> 다수 VM 생성 및 관리 용이
> 고가용성 및 애플리케이션 복원력 제공
> 리소스 수요 변화에 따라 자동으로 애플리케이션 크기 조정
>
### 가상 머신 집합 VMSS 생성 및 수동 크기 조정

1. VMSS 검색 및 만들기 클릭 
2. 이름 및 기본적인 설정
3. 디스크 탭에서 디스크 표준 만들고 새 디스크 추가하기 8기가 추가 
4. 가상네트워크 만들고 서브넷 192.168.0.0 , 192.168.2.0 192.168.3.0
5. 인스턴스 수 1개 
6. 배포 
7. 인스턴스 탭 클릭 


### PaaS 웹앱 만들기 
- Azure 웹 서비스 클릭
- 만들기
- 기본 도메인 접속 